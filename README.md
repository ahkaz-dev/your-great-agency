# AI Browser Autonomy Agent

## Общее описание

AI Browser Autonomy Agent — это автономный агент, который управляет реальным браузером Chromium через Playwright. Агент принимает естественноязыковые задачи через минималистичный веб-интерфейс или терминал CLI, сам планирует (иерархически), рассуждает (ReAct), выполняет действия в браузере, наблюдает и итеративно работает до завершения или пока не потребуется ввод пользователя.

**Ключевая особенность:** В проекте нет жестко заданных сценариев, предзаписанных селекторов или подсказок, специфичных для страниц. Агент адаптивно решает задачи.

## Основной функционал

### 1. Автоматизация браузера
- **Playwright** (Chromium, по умолчанию не headless) с надежными действиями (click, type, navigate, query)
- Динамический синтез селекторов на основе LLM и эвристик DOM
- Умное взаимодействие с веб-элементами с учетом семантики, ARIA и видимости

### 2. Цикл автономии
- **Planner + Executor + Critic** (планировщик + исполнитель + критик)
- Критик выполняет саморефлексию для обнаружения циклов и коррекции стратегии
- Короткосрочная рабочая память и долгосрочная эпизодическая память

### 3. Управление контекстом
- Сжатие наблюдений
- Поддержание релевантного окна истории
- Резюмирование доступных инструментов

### 4. Продвинутые паттерны
- Иерархическое планирование с разбивкой на вехи
- ReAct (Reasoning + Acting) для пошагового решения задач
- Механизм прерывания при необходимости ввода от пользователя

### 5. Безопасность
- Бюджет навигации и действий
- Защита от бесконечных циклов
- Опциональные ограничения доменов (через переменные окружения)

## Технические требования

### Перед началом работы
1. **Node.js** версии 18 или выше
2. **Python** версии 3.10 или выше

### Установка и запуск

#### Шаг 1: Клонируйте репозиторий
```bash
git clone <repository-url>
cd ai-browser-agent
```

#### Шаг 2: Установите зависимости
```bash
npm install
```

#### Шаг 3: Установите браузеры Playwright
```bash
npx playwright install --with-deps
```

#### Шаг 4: Настройте переменные окружения
Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

Отредактируйте `.env` файл:
```env
# LLM настройки (OpenAI-compatible API)
LLM_BASE_URL=https://api.openai.com/v1
LLM_API_KEY=ваш-api-ключ
LLM_MODEL=gpt-4o-mini

# Опционально: разрешенные домены (через запятую)
ALLOWED_HOSTS=
```

#### Шаг 5: Запуск

**Вариант 1: Веб-интерфейс (UI)**
```bash
npm run dev
```
Откройте http://localhost:5173 в браузере. Автоматически откроется окно Chromium для работы агента.

**Вариант 2: Командная строка (CLI)**
```bash
npm run agent "Ваша задача на естественном языке"
```
Пример:
```bash
npm run agent "Найди и обобщи 3 новости о квантовых вычислениях из авторитетных источников."
```

## Структура проекта

```
ai-browser-agent/
├── .env                    # Файл переменных окружения
├── .env.example           # Пример файла переменных окружения
├── package.json          # Зависимости и скрипты проекта
├── package-lock.json     # Блокировка версий зависимостей
├── tsconfig.json         # Конфигурация TypeScript
├── playwright.config.ts   # Конфигурация Playwright
├── src/                  # Исходный код
│   ├── index.ts          # Точка входа, оркестрация UI сервера и агента
│   ├── agent/            # Логика агента
│   │   ├── core.ts       # Основной цикл агента (Planner/Executor/Critic)
│   │   ├── llm.ts        # Абстракция LLM (OpenAI-compatible API)
│   │   ├── tools.ts      # Инструменты браузера для агента
│   │   ├── selectors.ts  # Динамическое обнаружение и оценка селекторов
│   │   └── memory.ts     # Управление контекстом и памятью
│   ├── browser/          # Управление браузером
│   │   └── controller.ts # Playwright обертка для надежных взаимодействий
│   └── server/           # Серверная часть
│       ├── server.ts     # Fastify сервер для API + WebSocket потоковая передача логов
│       ├── vite.config.ts # Конфигурация Vite
│       └── ui/           # Клиентская часть Vite + Vanilla TS
│           ├── index.html
│           ├── main.ts
│           └── style.css
└── dist/                 # Скомпилированный код (создается при сборке)
```

## Конфигурация LLM

Проект использует OpenAI-совместимый HTTP API для работы с языковыми моделями.

### Настройка OpenAI
```env
LLM_BASE_URL=https://api.openai.com/v1
LLM_API_KEY=sk-ваш-api-ключ
LLM_MODEL=gpt-4o-mini
```

### Настройка локальных моделей
Для использования локальных моделей (например, Ollama):
```env
LLM_BASE_URL=http://localhost:11434/v1
LLM_MODEL=ваша-модель
```

## Архитектурные особенности

### Динамические селекторы
- Отсутствуют статические селекторы, специфичные для страниц
- Целевые элементы вычисляются "на лету" с помощью извлечения DOM + LLM ранжирования + эвристической оценки
- Учитываются видимость, роль, семантика, текстовые подсказки, ARIA

### ReAct паттерн
- LLM рассуждает пошагово
- Выбирает инструмент (действие в браузере)
- Наблюдает за обратной связью со страницы
- Итеративно продолжает работу

### Иерархическое планирование
- Высокоуровневый план с вехами
- Исполнитель разбивает план на немедленные шаги

### Критик (самоконтроль)
- Обнаружение циклов и неверного направления
- Предложение корректировок стратегии

## Рекомендации по .gitignore

Для корректной работы Git рекомендуется создать или обновить файл `.gitignore` со следующим содержимым:

```
# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# Тестовые файлы
coverage/
.nyc_output/

# Окружение
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Сборка
dist/
build/
.next/
.nuxt/
.vuepress/dist/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# ОС
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# Логи
logs/
*.log

# Кэш
.cache/
.temp/
.tmp/

# Playwright
test-results/
playwright-report/
playwright/.cache/
```

## Запуск тестов

```bash
npm run playwright
```

## Сборка проекта

```bash
npm run build
```

## Важные замечания

1. **Исследовательский/демонстрационный проект** — проект предназначен в первую очередь для исследований и демонстрации возможностей
2. **Уважение к robots.txt** — всегда соблюдайте файл robots.txt целевых сайтов
3. **Безопасность данных** — не вводите чувствительную информацию через веб-интерфейс
4. **Тестирование** — перед использованием на реальных задачах протестируйте на простых примерах

## Лицензия

[Укажите лицензию проекта, если она есть]